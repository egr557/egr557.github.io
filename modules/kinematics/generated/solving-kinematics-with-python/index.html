<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>
Solving Kinematics Numerically with Python | Foldable Robotics
</title>

    <link href="/css/bootstrap.min.css" rel="stylesheet">

<style>
  .bd-placeholder-img {
    font-size: 1.125rem;
    text-anchor: middle;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }

  @media (min-width: 768px) {
    .bd-placeholder-img-lg {
      font-size: 3.5rem;
    }
  }
</style>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Oleo+Script:wght@400;700&display=swap" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet"> 


<link href="/css/blog.css" rel="stylesheet">
<link href="/css/features.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">


    <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <link rel="stylesheet" type="text/css" href="/hugo-cite.css" />

    <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
<link rel="manifest" href="/favicon/manifest.json">


  </head>
  <body>

    <div class="container">

      <header class="blog-header py-3">
  <div class="row flex-nowrap justify-content-between align-items-center">
    <div class="col-2 pt-1">
    </div>
    <div class="col-8 text-center">
      <a class="blog-header-logo text-dark" href="/">Foldable Robotics</a>
    </div>
    <div class="col-2 d-flex justify-content-end align-items-center">
    </div>
  </div>
</header>


      <nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Home</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        
        
        
        
        
      
        <li class="nav-item">
          <a class="nav-link" href="/assignments/">Assignments</a>
        </li>
        
        
        
        
        
      
        <li class="nav-item">
          <a class="nav-link" href="/calendar/">Course Calendar</a>
        </li>
        
        
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="/course-documents/" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Course Documents
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
            
            <li><a class="dropdown-item" href="/course-documents/software-list/">Software List</a></li>
            
            <li><a class="dropdown-item" href="/course-documents/submission-best-practices/">Submission Best Practices</a></li>
            
            <li><a class="dropdown-item" href="/course-documents/suggested-materials-list/">Suggested Materials List</a></li>
            
            <li><a class="dropdown-item" href="/course-documents/syllabus-web/">Syllabus for Foldable Robotics</a></li>
            
          </ul>
        </li>
        
        
        
        
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="/modules/" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Course Topics
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
            
            <li><a class="dropdown-item" href="/modules/biomechanics/">Biomechanics &amp; Bio-inspiration</a></li>
            
            <li><a class="dropdown-item" href="/modules/dynamics/">Dynamics</a></li>
            
            <li><a class="dropdown-item" href="/modules/validation/">Experimental Validation</a></li>
            
            <li><a class="dropdown-item" href="/modules/integration/">Integration</a></li>
            
            <li><a class="dropdown-item" href="/modules/introduction/">Introduction</a></li>
            
            <li><a class="dropdown-item" href="/modules/kinematics/">Kinematics</a></li>
            
            <li><a class="dropdown-item" href="/modules/compliance/">Mechanics and Compliance</a></li>
            
            <li><a class="dropdown-item" href="/modules/misc/">Misc</a></li>
            
            <li><a class="dropdown-item" href="/modules/optimization/">Optimization</a></li>
            
            <li><a class="dropdown-item" href="/modules/project/">Project</a></li>
            
            <li><a class="dropdown-item" href="/modules/manufacturing/">Prototyping &amp; Manufacturing</a></li>
            
            <li><a class="dropdown-item" href="/modules/python/">Python</a></li>
            
          </ul>
        </li>
        
        
        
        
        
      
        <li class="nav-item">
          <a class="nav-link" href="/lectures/">Lectures</a>
        </li>
        
        
        
        
        <li class="nav-item">
          
          <a class="nav-link" href="https://canvas.asu.edu/"target="_blank">Canvas <i class="bi bi-link"></i></a> 
        </li>
        
        
      </ul>
      <span class="navbar-text">
        Making better Foldable Robots
      </span>

    </div>
  </div>
</nav>

    </div>

    
<main class="container">
  <article>
  <h1 id="solving-kinematics-numerically-with-python">Solving Kinematics Numerically with Python</h1>
<h2 id="introduction">Introduction</h2>
<p>This module takes you through solving the motion of a device by using a numerical nonlinear solver to solve a complex system of constraint equations.  We will be using a number of Python packages to do this.</p>
<p>Note that solving kinematics numerically can prove troublesome, as the lack of a symbolic system of equations prevents us from analyzing those equations for situations when the system approaches a singularity, or when the initial guess for the state of the system is far away from the solution.  We will use a number of techniques to mitigate some of these problems but they are not always solvable.</p>
<h2 id="import-packages">Import Packages</h2>
<p>Import the packages you will need.  You will need <em>numpy</em> for array handling, <em>matplotlib</em>&rsquo;s plotting capabilities, the <em>scipy.optimize</em> package to do nonlinear multidimensional solving, and the <em>math</em> package for trig constants and functions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># This line produces inline images in jupyter notebook</span>
<span style="color:#f92672">%</span>matplotlib inline
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># import all the packages necessary for running the code</span>
<span style="color:#f92672">import</span> numpy
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> scipy.optimize
<span style="color:#f92672">import</span> math
</code></pre></div><h2 id="constraint-equations">Constraint Equations</h2>
<p>We will define some functions which will assist you in creating constraint equations for your mechanism.  These functions will be used over and over to define fixed elements of your design, such as the angle between two links, the length of a link, or the absolute angle between two vectors (using a reference).</p>
<h3 id="length-of-a-vector">Length of a Vector</h3>
<p>First you want to define a length constraint.  Assume a numpy array is fed in.  The function should return the length of the vector:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">length</span>(v1):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    finds the length of a vector
</span><span style="color:#e6db74">    
</span><span style="color:#e6db74">    :param v1: the vector
</span><span style="color:#e6db74">    :type v1: tuple or list of floats
</span><span style="color:#e6db74">    :rtypes: [float,] 
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    v1 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array(v1)<span style="color:#f92672">.</span>flatten()
    l <span style="color:#f92672">=</span> (v1<span style="color:#f92672">.</span>dot(v1))<span style="color:#f92672">**.</span><span style="color:#ae81ff">5</span>
    <span style="color:#66d9ef">return</span> l
</code></pre></div><h3 id="inner-angle-between-vectors">Inner angle between vectors</h3>
<p>Next you want to use the identity $\vec{v1}\cdot \vec{v2} = \left|\vec{v1}\right| \left|\vec{v2}\right|\cos{\theta}$.  This equation returns the inner angle between vectors without considering the direction of each vector.  It is useful, however, because given a valid initial condition, this formula can be used to maintain a fixed angle between vectors.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">inner_angle</span>(v1,v2):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    finds the interior angle between two vectors
</span><span style="color:#e6db74">    
</span><span style="color:#e6db74">    :param v1: the first vector
</span><span style="color:#e6db74">    :type v1: tuple or list of floats
</span><span style="color:#e6db74">    :param v2: the second vector
</span><span style="color:#e6db74">    :type v2: tuple or list of floats
</span><span style="color:#e6db74">    :rtypes: [float,] 
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
    v1 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array(v1)<span style="color:#f92672">.</span>flatten()
    l1 <span style="color:#f92672">=</span> length(v1)
    v2 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array(v2)<span style="color:#f92672">.</span>flatten()
    l2 <span style="color:#f92672">=</span> length(v2)
    cost <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>dot(v1,v2)<span style="color:#f92672">/</span>l1<span style="color:#f92672">/</span>l2
    t <span style="color:#f92672">=</span> math<span style="color:#f92672">.</span>acos(cost)
    <span style="color:#66d9ef">return</span> t
</code></pre></div><h3 id="absolute-angle-between-vectors">Absolute angle between vectors</h3>
<p>Sometimes it is necessary to specify the angle between two directed vectors.  This cannot be done using only sine or cosine due to their limited range when computing inverse sines and inverse cosines.  the <code>atan2</code> function may be used in code, but computing the absolute angle between vectors has two solutions unless you supply a third orientation vector v3, indicating the handedness of the solution you prefer.  We will assume that the desired reference vector is a unit vector in the positive z direction, but this can be supplied as an optional third term.  The following function has some error proofing code in it to ensure that the supplied reference is considered in determining which answer to use in solving the total angle between two vectors.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">total_angle</span>(v1,v2,v3<span style="color:#f92672">=</span>None):
    <span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">    finds the interior angle between two vectors
</span><span style="color:#e6db74">    
</span><span style="color:#e6db74">    :param v1: the first vector
</span><span style="color:#e6db74">    :type v1: tuple or list of floats
</span><span style="color:#e6db74">    :param v2: the second vector
</span><span style="color:#e6db74">    :type v2: tuple or list of floats
</span><span style="color:#e6db74">    :rtypes: [float,] 
</span><span style="color:#e6db74">    &#39;&#39;&#39;</span>

    v1 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array(v1)<span style="color:#f92672">.</span>flatten()
    <span style="color:#66d9ef">if</span> len(v1)<span style="color:#f92672">==</span><span style="color:#ae81ff">2</span>:
        v1 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>r_[v1,<span style="color:#ae81ff">0</span>]
        v3 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>])

        v2 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array(v2)<span style="color:#f92672">.</span>flatten()
    <span style="color:#66d9ef">if</span> len(v2)<span style="color:#f92672">==</span><span style="color:#ae81ff">2</span>:
        v2 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>r_[v2,<span style="color:#ae81ff">0</span>]
        v3 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>])

    costheta <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>dot(v1,v2)
    sintheta  <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>cross(v1,v2)
    l_sintheta <span style="color:#f92672">=</span> length(sintheta)
    neg <span style="color:#f92672">=</span> sintheta<span style="color:#f92672">.</span>dot(v3)
    <span style="color:#66d9ef">if</span> neg<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span>:
        neg <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">else</span>:
        neg<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
    theta <span style="color:#f92672">=</span> math<span style="color:#f92672">.</span>atan2(neg<span style="color:#f92672">*</span>l_sintheta,costheta)
    <span style="color:#66d9ef">return</span> theta    
</code></pre></div><h2 id="angle-between-planes">Angle Between Planes</h2>
<p>This function finds the angle between two planes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">angle_between_planes</span>(v1,v2,v3):
    <span style="color:#e6db74">&#39;&#39;&#39;measures the angle between planes.  
</span><span style="color:#e6db74">    v1 and v2 are two vectors which define one plane
</span><span style="color:#e6db74">    v2 and v3 define the third plane.&#39;&#39;&#39;</span>
    
    n1 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>cross(v1,v2)
    n2 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>cross(v2,v3)
    <span style="color:#66d9ef">return</span> total_angle(n1,n2,v2)
</code></pre></div><h2 id="constraint-equations-creation">Constraint Equations Creation</h2>
<p>The next function which is generated is responsible for generating and evaluating all the constraint equations for a given system.  Consider a four-bar linkage of four vectors</p>
<p><div class="text-center">
  <a href="/figures/kinematics/fourbar.png" target="_blank"><img src="/figures/kinematics/fourbar.png" alt="four bar linkage"  class="img-fluid"/></a>
</div></p>
<p>The planar four bar linkage can be defined by four points: $p_1$, $p_2$, $p_3$, and $p_4$.  The distance between these points is fixed by a rigid link.  Additionally, you can see that link 1 is rigidly attached to the world frame, which defines both its position and orientation.  For the 8 unknowns of the system, there must be 8 equations which can fully define the position of those four planar vectors.</p>
<p>To sum them up:</p>
<ul>
<li>Four length constraints</li>
<li>One point($p_1$) fixed at a set of coordinates</li>
<li>$v_1$ orientation fixed in space</li>
</ul>
<p>What is left?  The internal configuration of the four-bar linkage.  This can be determined by an extra equation defining the angle between $v_1$ and $v_4$, for example.  This is the single degree of freedom for the four-bar linkage itself.  In this example, $q$ may be considered the input variable which determines the configuration of the entire four-bar linkage.  Adding that final constraint sums to 8 constraint equations to match the 8 unknown variables in the system.</p>
<h3 id="implementation-in-python">Implementation in Python</h3>
<p>To solve these equations in python requires the use of the <code>scipy.optimize</code> module.  The <code>minimize</code> function takes a function and an initial guess for a number of variables, and attempts to reduce the error produced by the function.  So our description of our kinematic constraint equations must result in the form of a function that returns the error of a guess made by the <code>scipy.optimize.minimize</code> function.</p>
<p>But what if we want to build an arbitrary four-bar linkage?  If we supply specific constraint equations and a value for q, we will have to regenerate a new four-bar function for each design and configuration.  So instead, we wrap the four-bar constraint error calculation in another function which takes in our desired design and configuration variables, <code>q1,dl1,dl2,dl3,dl4</code>.  This wrapper permits us to reuse the calc_fourbar() function for any four-bar linkage for which we have a set of desired link lengths and input angle.  The implementation can be seen below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">p0_ini <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>
p1_ini <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>
p2_ini <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>
p3_ini <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
p4_ini <span style="color:#f92672">=</span> <span style="color:#f92672">.</span><span style="color:#ae81ff">5</span>,<span style="color:#f92672">-.</span><span style="color:#ae81ff">5</span>
p_ini <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([p0_ini,p1_ini,p2_ini,p3_ini,p4_ini])
</code></pre></div><p>define a list of label strings for labeling points</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">point_text <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;p0&#39;</span>,<span style="color:#e6db74">&#39;p1&#39;</span>,<span style="color:#e6db74">&#39;p2&#39;</span>,<span style="color:#e6db74">&#39;p3&#39;</span>,<span style="color:#e6db74">&#39;p4&#39;</span>]
</code></pre></div><p>Define a list of vectors by the index of the points used</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">vector_order <span style="color:#f92672">=</span> []
vector_order<span style="color:#f92672">.</span>append((<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>))
vector_order<span style="color:#f92672">.</span>append((<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>))
vector_order<span style="color:#f92672">.</span>append((<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>))
vector_order<span style="color:#f92672">.</span>append((<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">0</span>))
vector_order<span style="color:#f92672">.</span>append((<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>))
vector_order<span style="color:#f92672">.</span>append((<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>))
vector_order <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array(vector_order)
</code></pre></div><p>For each vector, define the initial vector as the difference from point 1 minus point 0</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">v_ini <span style="color:#f92672">=</span> p_ini[vector_order[:,<span style="color:#ae81ff">1</span>]]<span style="color:#f92672">-</span>p_ini[vector_order[:,<span style="color:#ae81ff">0</span>]]
v_ini
</code></pre></div><pre><code>array([[ 1. ,  0. ],
       [ 0. ,  1. ],
       [-2. , -2. ],
       [ 1. ,  1. ],
       [-0.5, -1.5],
       [ 1.5,  0.5]])
</code></pre>
<p>Calculate the initial length</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">l_ini <span style="color:#f92672">=</span> [length(item) <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> v_ini]
l_ini
</code></pre></div><pre><code>[1.0,
 1.0,
 2.8284271247461903,
 1.4142135623730951,
 1.5811388300841898,
 1.5811388300841898]
</code></pre>
<p>Compute the text location as halfway between point 0 and 1 for each vector</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">text_location <span style="color:#f92672">=</span> (p_ini[vector_order[:,<span style="color:#ae81ff">1</span>]]<span style="color:#f92672">+</span>p_ini[vector_order[:,<span style="color:#ae81ff">0</span>]])<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>
text_location
</code></pre></div><pre><code>array([[ 0.5 ,  0.  ],
       [ 1.  ,  0.5 ],
       [ 0.  ,  0.  ],
       [-0.5 , -0.5 ],
       [ 0.75,  0.25],
       [-0.25, -0.75]])
</code></pre>
<p>Add labels for labeling the vector midpoint</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">vector_text <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;v0&#39;</span>,<span style="color:#e6db74">&#39;v1&#39;</span>,<span style="color:#e6db74">&#39;v2&#39;</span>,<span style="color:#e6db74">&#39;v3&#39;</span>,<span style="color:#e6db74">&#39;v4&#39;</span>,<span style="color:#e6db74">&#39;v5&#39;</span>]
</code></pre></div><p>Create a function that plots a mechanism</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">plot_mechanism</span>(point_location,text_location<span style="color:#f92672">=</span>None):
    <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> vector_order:
        plt<span style="color:#f92672">.</span>plot(<span style="color:#f92672">*</span>(point_location[item,:<span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>T),<span style="color:#e6db74">&#39;ko-&#39;</span>)

    <span style="color:#66d9ef">if</span> text_location <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        <span style="color:#66d9ef">for</span> item,text <span style="color:#f92672">in</span> zip(point_location,point_text):
            ax<span style="color:#f92672">.</span>text(x<span style="color:#f92672">=</span>item[<span style="color:#ae81ff">0</span>],y<span style="color:#f92672">=</span>item[<span style="color:#ae81ff">1</span>],s<span style="color:#f92672">=</span>text)

        <span style="color:#66d9ef">for</span> item,text <span style="color:#f92672">in</span> zip(text_location,vector_text):
            ax<span style="color:#f92672">.</span>text(x<span style="color:#f92672">=</span>item[<span style="color:#ae81ff">0</span>],y<span style="color:#f92672">=</span>item[<span style="color:#ae81ff">1</span>],s<span style="color:#f92672">=</span>text)

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure();
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">111</span>)
plot_mechanism(p_ini,text_location)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><div class="text-center">
  <a href="output_27_0.png" target="_blank"><img src="output_27_0.png" alt="png"  class="img-fluid"/></a>
</div></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_function</span>(q1,dl1,dl2,dl3,dl4,dl5,dl6):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calc_fourbar</span>(arguments):
        <span style="color:#75715e"># break arguments variable into 8 discrete variables, 2 for each planar point in the four-bar linkage</span>
        x0,y0,x1,y1,x2,y2,x3,y3,x4,y4 <span style="color:#f92672">=</span> arguments
        
        <span style="color:#75715e">#Create four points: p1, p2, p3, p4</span>
        p0 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([x0,y0])
        p1 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([x1,y1])
        p2 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([x2,y2])
        p3 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([x3,y3])
        p4 <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([x4,y4])

        
        <span style="color:#75715e">#create new point array using inputs of function</span>
        p <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([p0,p1,p2,p3,p4])
        
        <span style="color:#75715e">#create new vector array using vector ordering defined above</span>
        v <span style="color:#f92672">=</span> p[vector_order[:,<span style="color:#ae81ff">1</span>]]<span style="color:#f92672">-</span>p[vector_order[:,<span style="color:#ae81ff">0</span>]]
        
        <span style="color:#75715e">#create new length vector</span>
        l <span style="color:#f92672">=</span> [length(item) <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> v]

        <span style="color:#75715e"># Define the x and y axis unit vectors</span>
        x_axis <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>])
        y_axis <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>])

        <span style="color:#75715e"># define the error variable for holding all mechanism error calcs</span>
        error <span style="color:#f92672">=</span> []

        <span style="color:#75715e"># Compute the error in the structure as the absolute, cumulative </span>
        <span style="color:#75715e"># difference between the link lengths and their desired lengths</span>
        error<span style="color:#f92672">.</span>append([l[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>dl1])
        error<span style="color:#f92672">.</span>append([l[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span>dl2])
        error<span style="color:#f92672">.</span>append([l[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>dl3])
        error<span style="color:#f92672">.</span>append([l[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">-</span>dl4])
        error<span style="color:#f92672">.</span>append([l[<span style="color:#ae81ff">4</span>]<span style="color:#f92672">-</span>dl5])
        error<span style="color:#f92672">.</span>append([l[<span style="color:#ae81ff">5</span>]<span style="color:#f92672">-</span>dl6])
        
        <span style="color:#75715e"># add the desired input angle q1 minus the actual angle as another error component to be solved</span>
        error<span style="color:#f92672">.</span>append([total_angle(v[<span style="color:#ae81ff">0</span>],<span style="color:#f92672">-</span>v[<span style="color:#ae81ff">3</span>])<span style="color:#f92672">-</span>q1<span style="color:#f92672">*</span>math<span style="color:#f92672">.</span>pi<span style="color:#f92672">/</span><span style="color:#ae81ff">180</span>])
        <span style="color:#75715e">#error.append([inner_angle(-v4,y_axis)-q1*math.pi/180+math.pi/2])</span>
        
        <span style="color:#75715e"># add two more constraints defining p1 as fixed at (0,0)</span>
        error<span style="color:#f92672">.</span>append([p[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>])
        error<span style="color:#f92672">.</span>append([p[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>])
        
        <span style="color:#75715e"># define v1 to be parallel to the x axis.</span>
        error<span style="color:#f92672">.</span>append([inner_angle(v[<span style="color:#ae81ff">0</span>],x_axis)<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>])

        <span style="color:#75715e"># turn the error list into a vector</span>
        error1 <span style="color:#f92672">=</span>numpy<span style="color:#f92672">.</span>array(error)
        
        <span style="color:#75715e"># return the square root of the sum of squared errors.  The length function that we wrote earlier does that.</span>
        <span style="color:#66d9ef">return</span> length(error1)
    
    <span style="color:#66d9ef">return</span> calc_fourbar
</code></pre></div><p>To test the function we simply need to create a valid initial guess for the initial locations of the 8 variables <code>x1,y1,x2,y2,x3,y3,x4,y4</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ini <span style="color:#f92672">=</span> list(p_ini<span style="color:#f92672">.</span>flatten())
</code></pre></div><p>as well as a set of design variables for <code>dl1,dl2,dl3,dl4</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">design <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4.4</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">3</span>])
</code></pre></div><p>and a state for the one configuration variable <code>q1</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">q1<span style="color:#f92672">=-</span><span style="color:#ae81ff">170</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">function<span style="color:#f92672">=</span>gen_function(q1,<span style="color:#f92672">*</span>design)
result  <span style="color:#f92672">=</span> scipy<span style="color:#f92672">.</span>optimize<span style="color:#f92672">.</span>minimize(function,ini)
x <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span>x
x <span style="color:#f92672">=</span>x<span style="color:#f92672">.</span>reshape((<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>))
</code></pre></div><p>Compute the error of the resulting configuration found.  If it is near zero, it was able to find a solution</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">result<span style="color:#f92672">.</span>fun
</code></pre></div><pre><code>6.995398416354163e-08
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure();
ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">111</span>)
plot_mechanism(x)
plt<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;equal&#39;</span>)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><div class="text-center">
  <a href="output_38_0.png" target="_blank"><img src="output_38_0.png" alt="png"  class="img-fluid"/></a>
</div></p>
<h2 id="computing-a-path">Computing a Path</h2>
<p>But what if we want to compute more than one configuration in the same plot?  We need to re-run the optimize function with different values for q.  The example below does just that.  Additionally, we only want to show valid solutions, so we add some error proofing to check whether a solution has error below a desired tolerance.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">all_q <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>r_[<span style="color:#f92672">-</span><span style="color:#ae81ff">170</span>:<span style="color:#ae81ff">181</span>:<span style="color:#ae81ff">10</span>]
path <span style="color:#f92672">=</span> []
q_in <span style="color:#f92672">=</span> []
ini<span style="color:#f92672">=</span>result<span style="color:#f92672">.</span>x
<span style="color:#66d9ef">for</span> q1 <span style="color:#f92672">in</span> all_q:
    function<span style="color:#f92672">=</span>gen_function(q1,<span style="color:#f92672">*</span>design)
    result  <span style="color:#f92672">=</span> scipy<span style="color:#f92672">.</span>optimize<span style="color:#f92672">.</span>minimize(function,ini)
    points <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span>x
    points <span style="color:#f92672">=</span>points<span style="color:#f92672">.</span>reshape((<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">2</span>))

    <span style="color:#75715e"># Only add solution to path if the error is smaller than some nominal value</span>
    <span style="color:#66d9ef">print</span>(result<span style="color:#f92672">.</span>fun)

    <span style="color:#66d9ef">if</span> result<span style="color:#f92672">.</span>fun<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">1e-1</span>:
        path<span style="color:#f92672">.</span>append(points)
        q_in<span style="color:#f92672">.</span>append(q1)
        ini <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span>x

path <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array(path)
q_in <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array(q_in)
</code></pre></div><pre><code>6.994958769426199e-08
9.03578396742785e-08
6.818126377658796e-08
1.1818014822372901e-07
1.3004526572734587e-07
7.467395056150183e-08
1.2559675148416404e-07
1.4897331305062183e-07
1.253274772729213e-07
1.258116374074979e-07
1.505113906941631e-07
1.1481247697290997e-07
1.3302576309248917e-07
1.5438581509636946e-07
1.4823286472018718e-07
8.048563077184548e-08
1.501539143887747e-07
8.411210379488795e-08
1.3379806951996817e-07
5.470048532108741e-08
7.428209498159685e-08
9.595800307845717e-08
1.1400509698539673e-07
1.203941078844774e-07
1.1868997192356723e-07
9.960076488049228e-08
9.571107464619422e-08
6.135278614690043e-08
7.810011261766794e-08
8.497313988110125e-08
8.837061348200097e-08
8.54950552319171e-08
8.865031358808815e-08
1.427182998700313e-07
7.347182723175156e-08
0.059675897246800585
</code></pre>
<p>Plotting the result&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure()
a <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">111</span>)
<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> path:
    plot_mechanism(item)
plt<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;equal&#39;</span>)
plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#39;f1.png&#39;</span>)
</code></pre></div><p><div class="text-center">
  <a href="output_42_0.png" target="_blank"><img src="output_42_0.png" alt="png"  class="img-fluid"/></a>
</div></p>
<h2 id="computing-the-jacobian">Computing The Jacobian</h2>
<p>Now consider we want to look at an end-effector attached to $\vec{v}_3$.  Plotting the end effector p4:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">path<span style="color:#f92672">.</span>shape
</code></pre></div><pre><code>(36, 5, 2)
</code></pre>
<p>This plots as the following set of points:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">plt<span style="color:#f92672">.</span>figure()
p4 <span style="color:#f92672">=</span> path[:,<span style="color:#ae81ff">4</span>,:]
<span style="color:#75715e">#p4 = numpy.r_[p4,p4[0:1]]</span>
plt<span style="color:#f92672">.</span>plot(p4[:,<span style="color:#ae81ff">0</span>],p4[:,<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#39;go-&#39;</span>)
plt<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;equal&#39;</span>)
plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#39;f2.png&#39;</span>)
</code></pre></div><p><div class="text-center">
  <a href="output_46_0.png" target="_blank"><img src="output_46_0.png" alt="png"  class="img-fluid"/></a>
</div></p>
<p>But what if we&rsquo;re only interested in the portion of the path where the end effector is supposed to be touching the ground?  Restricting to that portion of the path:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">y_out <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>vstack([p4,p4[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>]])
y_out
</code></pre></div><pre><code>array([[ 0.64264265, -2.69384763],
       [ 0.7828071 , -2.79823562],
       [ 0.95188307, -2.88646359],
       [ 1.14481075, -2.95549859],
       [ 1.35560967, -3.00354474],
       [ 1.57761488, -3.03016873],
       [ 1.80367917, -3.0363504 ],
       [ 2.02631997, -3.02444975],
       [ 2.23779282, -2.99806976],
       [ 2.43010895, -2.96177114],
       [ 2.59504363, -2.92057242],
       [ 2.72424749, -2.87916297],
       [ 2.8096761 , -2.84079601],
       [ 2.8446389 , -2.80599015],
       [ 2.82567041, -2.77151729],
       [ 2.75487839, -2.73055544],
       [ 2.64131426, -2.6748451 ],
       [ 2.49927055, -2.59849718],
       [ 2.34322093, -2.50118151],
       [ 2.18279387, -2.38830935],
       [ 2.02157382, -2.26852097],
       [ 1.85940198, -2.1508784 ],
       [ 1.69523179, -2.04329031],
       [ 1.52883464, -1.9520413 ],
       [ 1.36136489, -1.88182058],
       [ 1.19531724, -1.83586468],
       [ 1.03425529, -1.81608172],
       [ 0.88249039, -1.82314016],
       [ 0.74476959, -1.8565349 ],
       [ 0.62598404, -1.91465079],
       [ 0.5308936 , -1.99483821],
       [ 0.46386026, -2.0935118 ],
       [ 0.42858645, -2.2062852 ],
       [ 0.42786054, -2.32814793],
       [ 0.46332557, -2.45369074],
       [ 0.50267501, -2.53323713],
       [ 0.64264265, -2.69384763],
       [ 0.7828071 , -2.79823562]])
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">q_in <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>r_[q_in,q_in[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>]]
q_in
</code></pre></div><pre><code>array([-170, -160, -150, -140, -130, -120, -110, -100,  -90,  -80,  -70,
        -60,  -50,  -40,  -30,  -20,  -10,    0,   10,   20,   30,   40,
         50,   60,   70,   80,   90,  100,  110,  120,  130,  140,  150,
        160,  170,  180, -170, -160])
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">range_min <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
range_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">if</span> range_min<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">0</span>:
    y_out <span style="color:#f92672">=</span> p4[range_min:range_max]
    q_in <span style="color:#f92672">=</span> q_in[range_min:range_max]
<span style="color:#66d9ef">else</span>:
    y_out <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>vstack([p4[range_min:,:],p4[<span style="color:#ae81ff">0</span>:range_max,:]])
    q_in <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>r_[q_in[range_min:],q_in[<span style="color:#ae81ff">0</span>:range_max]]
</code></pre></div><p>Now we may calculate the relative change in position of the end-effector (in green) between each step as a function of the change in input angle $q$.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure()
a <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">111</span>)

<span style="color:#75715e">#for item in path[range_min:range_max]:</span>
<span style="color:#75715e">#    plot_mechanism(item)</span>
    
a<span style="color:#f92672">.</span>plot(p4[:,<span style="color:#ae81ff">0</span>],p4[:,<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#39;go-&#39;</span>)    
a<span style="color:#f92672">.</span>plot(y_out[:,<span style="color:#ae81ff">0</span>],y_out[:,<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#39;ro-&#39;</span>)    
plt<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;equal&#39;</span>)
plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#39;f3.png&#39;</span>)
</code></pre></div><p><div class="text-center">
  <a href="output_53_0.png" target="_blank"><img src="output_53_0.png" alt="png"  class="img-fluid"/></a>
</div></p>
<p>We use the trapezoidal rule to find the slope in y as a function of the previous and next neighbors of each point in the path.  For a path of n points this will produce n-2 sets of partial derivatives</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dy <span style="color:#f92672">=</span> y_out[<span style="color:#ae81ff">2</span>:,:]<span style="color:#f92672">-</span>y_out[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>,:]
dy
</code></pre></div><pre><code>array([[ 0.30924041, -0.19261596],
       [ 0.36200364, -0.15726297],
       [ 0.40372661, -0.11708114],
       [ 0.43280413, -0.07467014],
       [ 0.4480695 , -0.03280566],
       [ 0.44870509,  0.00571898],
       [ 0.43411364,  0.03828064],
       [ 0.40378898,  0.06267861],
       [ 0.35725081,  0.07749734]])
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dq <span style="color:#f92672">=</span> q_in[<span style="color:#ae81ff">2</span>:]<span style="color:#f92672">-</span>q_in[:<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>]
dq
</code></pre></div><pre><code>array([20, 20, 20, 20, 20, 20, 20, 20, 20])
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">dq<span style="color:#f92672">.</span>shape
</code></pre></div><pre><code>(9,)
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure()
a <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">111</span>)

<span style="color:#75715e">#for item in path[range_min:range_max]:</span>
<span style="color:#75715e">#    plot_mechanism(item)</span>
    
a<span style="color:#f92672">.</span>plot(p4[:,<span style="color:#ae81ff">0</span>],p4[:,<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#39;go-&#39;</span>)    
a<span style="color:#f92672">.</span>plot(y_out[:,<span style="color:#ae81ff">0</span>],y_out[:,<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#39;ro-&#39;</span>)    
plt<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;equal&#39;</span>)
plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#39;f3.png&#39;</span>)
</code></pre></div><p><div class="text-center">
  <a href="output_58_0.png" target="_blank"><img src="output_58_0.png" alt="png"  class="img-fluid"/></a>
</div></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">plt<span style="color:#f92672">.</span>figure()
plt<span style="color:#f92672">.</span>plot(y_out[:,<span style="color:#ae81ff">0</span>],y_out[:,<span style="color:#ae81ff">1</span>],<span style="color:#e6db74">&#39;ro-&#39;</span>)    
plt<span style="color:#f92672">.</span>quiver(y_out[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>],y_out[<span style="color:#ae81ff">1</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>],dy[:,<span style="color:#ae81ff">0</span>],dy[:,<span style="color:#ae81ff">1</span>])
plt<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;equal&#39;</span>)
plt<span style="color:#f92672">.</span>show()

</code></pre></div><p><div class="text-center">
  <a href="output_59_0.png" target="_blank"><img src="output_59_0.png" alt="png"  class="img-fluid"/></a>
</div></p>
<p>Dividing dy over dq produces 10, 2x1 Jacobian matrices, 1 for each interior point in the motion path.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">J<span style="color:#f92672">=</span>(dy<span style="color:#f92672">.</span>T<span style="color:#f92672">/</span>dq<span style="color:#f92672">.</span>T)
J<span style="color:#f92672">.</span>shape
</code></pre></div><pre><code>(2, 9)
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">J
</code></pre></div><pre><code>array([[ 0.01546202,  0.01810018,  0.02018633,  0.02164021,  0.02240348,
         0.02243525,  0.02170568,  0.02018945,  0.01786254],
       [-0.0096308 , -0.00786315, -0.00585406, -0.00373351, -0.00164028,
         0.00028595,  0.00191403,  0.00313393,  0.00387487]])
</code></pre>
<p>Now let&rsquo;s find the torque required to accelerage a 1-kg mass forward at 1g, while holding itself up against gravity:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">m <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e">#kg</span>
g <span style="color:#f92672">=</span> <span style="color:#ae81ff">9.81</span> <span style="color:#75715e">#m/s^2</span>
fx <span style="color:#f92672">=</span> m<span style="color:#f92672">*</span>g
fy <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>m<span style="color:#f92672">*</span>g
f <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>array([[fx,fy]])<span style="color:#f92672">.</span>T
t <span style="color:#f92672">=</span> J<span style="color:#f92672">.</span>T<span style="color:#f92672">.</span>dot(f)
t <span style="color:#75715e">#N-m</span>
</code></pre></div><pre><code>array([[0.24616055],
       [0.25470027],
       [0.2554562 ],
       [0.24891613],
       [0.23586927],
       [0.21728469],
       [0.19415609],
       [0.16731464],
       [0.13721908]])
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">t<span style="color:#f92672">.</span>max()
</code></pre></div><pre><code>0.2554562024243693
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">t<span style="color:#f92672">.</span>min()
</code></pre></div><pre><code>0.13721907554495927
</code></pre>
<p>Thus, the torque required by a motor to hold those forces specified by $f_x$ and $f_y$ is around .25 N-m in the worst case.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">motor_speed <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span><span style="color:#75715e">#rpm</span>
dq_dt <span style="color:#f92672">=</span> motor_speed<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>math<span style="color:#f92672">.</span>pi<span style="color:#f92672">/</span><span style="color:#ae81ff">60</span>
velocity <span style="color:#f92672">=</span> J<span style="color:#f92672">*</span>dq_dt
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">velocity[<span style="color:#ae81ff">0</span>,:]
</code></pre></div><pre><code>array([0.80958951, 0.94772333, 1.05695379, 1.13307856, 1.17304321,
       1.17470717, 1.13650686, 1.05711709, 0.93528043])
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f
</code></pre></div><pre><code>array([[ 9.81],
       [-9.81]])
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">P <span style="color:#f92672">=</span> t<span style="color:#f92672">.</span>dot(dq_dt)
P
</code></pre></div><pre><code>array([[12.88893646],
       [13.33607515],
       [13.37565548],
       [13.03321797],
       [12.35008598],
       [11.37699962],
       [10.1659891 ],
       [ 8.76057407],
       [ 7.18477399]])
</code></pre>

  </article>
</main>


    
    <footer class="blog-footer">
      <p>Copyright &copy; 2021 Daniel M. Aukes.  All rights reserved.</p>
      <p><a href="#">Back to top</a></p>
    </footer>
    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

  </body>
</html>
