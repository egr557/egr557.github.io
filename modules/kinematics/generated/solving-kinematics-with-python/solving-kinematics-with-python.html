<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="This site is about foldable robotics.
">
  <meta name="author" content="Daniel M. Aukes">
  <meta name="generator" content="Jekyll v4.1.1">
  <title>Solving Kinematics Numerically with Python | Foldable Robotics </title>

  <!--<link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/blog/">-->
  
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&display=swap" rel="stylesheet"> 
  <link href="https://fonts.googleapis.com/css2?family=Oleo+Script:wght@400;700&display=swap" rel="stylesheet"> 
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet"> 
  
  <!-- Bootstrap core CSS -->
  <link href="/assets/bootstrap-4.5.3-dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }
  </style>
  
  <!-- Custom styles for this template -->
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
  <!-- Custom styles for this template -->

  <link href="/assets/blog.css" rel="stylesheet">
  <link href="/assets/fontawesome-free-5.15.1-web/css/all.css" rel="stylesheet"> <!--load all styles -->
  
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
  <link rel="manifest" href="/assets/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/favicon/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
</head>
<body>
<div class="container">      
<header class="blog-header py-3">
  <div class="row flex-nowrap justify-content-between align-items-center">
    <div class="col-2 pt-1">
      
    </div>
    <div class="col-8 text-center">
      <a class="blog-header-logo text-dark" href="/">Foldable Robotics</a>
    </div>
    <div class="col-2 d-flex justify-content-end align-items-center">

    </div>
  </div>
</header>


<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="/">Home</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Modules
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          
          <a class="dropdown-item" href="/modules/introduction">Introduction</a>
          
          <a class="dropdown-item" href="/modules/biomechanics">Biomechanics</a>
          
          <a class="dropdown-item" href="/modules/kinematics">Kinematics</a>
          
          <a class="dropdown-item" href="/modules/compliance">Mechanics and Compliance</a>
          
          <a class="dropdown-item" href="/modules/dynamics">Dynamics</a>
          
          <a class="dropdown-item" href="/modules/optimization">Optimization</a>
          
          <a class="dropdown-item" href="/modules/manufacturing">Prototyping & Manufacturing</a>
          
          <a class="dropdown-item" href="/modules/integration">Integration</a>
          
          <a class="dropdown-item" href="/modules/validation">Experimental Validation</a>
          
          <a class="dropdown-item" href="/modules/project">Project</a>
          
          <a class="dropdown-item" href="/modules/python">Python</a>
          
          <a class="dropdown-item" href="/modules/misc">Misc</a>
          
        </div>
      </li>
      
      <li class="nav-item">
      
      <a class="nav-link" href="/class_schedule">Class Schedule</a>
      

      </li>
      
      <li class="nav-item">
      
      <a class="nav-link" href="/my-assignments">Assignments</a>
      

      </li>
      
      <li class="nav-item">
      
      <a class="nav-link" href="/my-tutorials">Tutorials</a>
      

      </li>
      
      <li class="nav-item">
      
      <a class="nav-link" href="https://canvas.asu.edu/calendar#view_name=month" target="_blank">Canvas Calendar <i class="fas fa-external-link-alt"></i></i></a>
      

      </li>
      
      <li class="nav-item">
      
      <a class="nav-link" href="https://canvas.asu.edu/courses/71725" target="_blank">Canvas <i class="fas fa-external-link-alt"></i></i></a>
      

      </li>
      
  </div>
</nav>
<div class="row">
<div class="col-md-4 text-center">
  
  
      <h5>
        Module: <a href="/modules/kinematics">kinematics</a>
      </h5>
  
  
</div>
<div class="col-md-4 text-center">
  
  
      <h4>
        Solving Kinematics Numerically with Python
      </h4>
  
  
</div>
<div class="col-md-4 text-center">
  
</div>
</div>
</div><!-- /.row -->
<main role="main" class="container">
  <h1 id="solving-kinematics-numerically-with-python">Solving Kinematics Numerically with Python</h1>
<h2 id="introduction">Introduction</h2>
<p>This module takes you through solving the motion of a device by using a numerical nonlinear solver to solve a complex system of constraint equations. We will be using a number of Python packages to do this.</p>
<p>Note that solving kinematics numerically can prove troublesome, as the lack of a symbolic system of equations prevents us from analyzing those equations for situations when the system approaches a singularity, or when the initial guess for the state of the system is far away from the solution. We will use a number of techniques to mitigate some of these problems but they are not always solvable.</p>
<h2 id="import-packages">Import Packages</h2>
<p>Import the packages you will need. You will need <em>numpy</em> for array handling, <em>matplotlib</em>â€™s plotting capabilities, the <em>scipy.optimize</em> package to do nonlinear multidimensional solving, and the <em>math</em> package for trig constants and functions.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This line produces inline images in jupyter notebook</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># import all the packages necessary for running the code</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.optimize</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span></code></pre></div>
<h2 id="constraint-equations">Constraint Equations</h2>
<p>We will define some functions which will assist you in creating constraint equations for your mechanism. These functions will be used over and over to define fixed elements of your design, such as the angle between two links, the length of a link, or the absolute angle between two vectors (using a reference).</p>
<h3 id="length-of-a-vector">Length of a Vector</h3>
<p>First you want to define a length constraint. Assume a numpy array is fed in. The function should return the length of the vector:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> length(v1):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    finds the length of a vector</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param v1: the vector</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :type v1: tuple or list of floats</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :rtype: float</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> numpy.array(v1).flatten()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    l <span class="op">=</span> (v1.dot(v1))<span class="op">**</span><span class="fl">.5</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> l</span></code></pre></div>
<h3 id="inner-angle-between-vectors">Inner angle between vectors</h3>
<p>Next you want to use the identity <span class="math inline">\(\vec{v1}\cdot \vec{v2} = \left|\vec{v1}\right| \left|\vec{v2}\right|\cos{\theta}\)</span>. This equation returns the inner angle between vectors without considering the direction of each vector. It is useful, however, because given a valid initial condition, this formula can be used to maintain a fixed angle between vectors.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inner_angle(v1,v2):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    finds the interior angle between two vectors</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param v1: the first vector</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :type v1: tuple or list of floats</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :param v2: the second vector</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">    :type v2: tuple or list of floats</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    :rtype: float</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> numpy.array(v1).flatten()</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    l1 <span class="op">=</span> length(v1)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    v2 <span class="op">=</span> numpy.array(v2).flatten()</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    l2 <span class="op">=</span> length(v2)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    cost <span class="op">=</span> numpy.dot(v1,v2)<span class="op">/</span>l1<span class="op">/</span>l2</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    t <span class="op">=</span> math.acos(cost)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> t</span></code></pre></div>
<h3 id="absolute-angle-between-vectors">Absolute angle between vectors</h3>
<p>Sometimes it is necessary to specify the angle between two directed vectors. This cannot be done using only sine or cosine due to their limited range when computing inverse sines and inverse cosines. the <code>atan2</code> function may be used in code, but computing the absolute angle between vectors has two solutions unless you supply a third orientation vector v3, indicating the handedness of the solution you prefer. We will assume that the desired reference vector is a unit vector in the positive z direction, but this can be supplied as an optional third term. The following function has some error proofing code in it to ensure that the supplied reference is considered in determining which answer to use in solving the total angle between two vectors.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> total_angle(v1,v2,v3<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    finds the interior angle between two vectors</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param v1: the first vector</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :type v1: tuple or list of floats</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :param v2: the second vector</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    :type v2: tuple or list of floats</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    :rtype: float</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">    &#39;&#39;&#39;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> numpy.array(v1).flatten()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(v1)<span class="op">==</span><span class="dv">2</span>:</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        v1 <span class="op">=</span> numpy.r_[v1,<span class="dv">0</span>]</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        v3 <span class="op">=</span> numpy.array([<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        v2 <span class="op">=</span> numpy.array(v2).flatten()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(v2)<span class="op">==</span><span class="dv">2</span>:</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        v2 <span class="op">=</span> numpy.r_[v2,<span class="dv">0</span>]</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        v3 <span class="op">=</span> numpy.array([<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    costheta <span class="op">=</span> numpy.dot(v1,v2)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    sintheta  <span class="op">=</span> numpy.cross(v1,v2)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    l_sintheta <span class="op">=</span> length(sintheta)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    neg <span class="op">=</span> sintheta.dot(v3)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> neg<span class="op">&lt;</span><span class="dv">0</span>:</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        neg <span class="op">=</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>        neg<span class="op">=</span><span class="dv">1</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> math.atan2(neg<span class="op">*</span>l_sintheta,costheta)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> theta    </span></code></pre></div>
<h2 id="angle-between-planes">Angle Between Planes</h2>
<p>This function finds the angle between two planes</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> angle_between_planes(v1,v2,v3):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39;&#39;&#39;measures the angle between planes.  </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    v1 and v2 are two vectors which define one plane</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">    v2 and v3 define the third plane.&#39;&#39;&#39;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    n1 <span class="op">=</span> numpy.cross(v1,v2)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    n2 <span class="op">=</span> numpy.cross(v2,v3)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total_angle(n1,n2,v2)</span></code></pre></div>
<h2 id="constraint-equations-creation">Constraint Equations Creation</h2>
<p>The next function which is generated is responsible for generating and evaluating all the constraint equations for a given system. Consider a four-bar linkage of four vectors</p>
<figure>
<img src="../figures/kinematics/fourbar.png" alt="four bar linkage" /><figcaption aria-hidden="true">four bar linkage</figcaption>
</figure>
<p>The planar four bar linkage can be defined by four points: <span class="math inline">\(p_1\)</span>, <span class="math inline">\(p_2\)</span>, <span class="math inline">\(p_3\)</span>, and <span class="math inline">\(p_4\)</span>. The distance between these points is fixed by a rigid link. Additionally, you can see that link 1 is rigidly attached to the world frame, which defines both its position and orientation. For the 8 unknowns of the system, there must be 8 equations which can fully define the position of those four planar vectors.</p>
<p>To sum them up:</p>
<ul>
<li>Four length constraints</li>
<li>One point(<span class="math inline">\(p_1\)</span>) fixed at a set of coordinates</li>
<li><span class="math inline">\(v_1\)</span> orientation fixed in space</li>
</ul>
<p>What is left? The internal configuration of the four-bar linkage. This can be determined by an extra equation defining the angle between <span class="math inline">\(v_1\)</span> and <span class="math inline">\(v_4\)</span>, for example. This is the single degree of freedom for the four-bar linkage itself. In this example, <span class="math inline">\(q\)</span> may be considered the input variable which determines the configuration of the entire four-bar linkage. Adding that final constraint sums to 8 constraint equations to match the 8 unknown variables in the system.</p>
<h3 id="implementation-in-python">Implementation in Python</h3>
<p>To solve these equations in python requires the use of the <code>scipy.optimize</code> module. The <code>minimize</code> function takes a function and an initial guess for a number of variables, and attempts to reduce the error produced by the function. So our description of our kinematic constraint equations must result in the form of a function that returns the error of a guess made by the <code>scipy.optimize.minimize</code> function.</p>
<p>But what if we want to build an arbitrary four-bar linkage? If we supply specific constraint equations and a value for q, we will have to regenerate a new four-bar function for each design and configuration. So instead, we wrap the four-bar constraint error calculation in another function which takes in our desired design and configuration variables, <code>q1,dl1,dl2,dl3,dl4</code>. This wrapper permits us to reuse the calc_fourbar() function for any four-bar linkage for which we have a set of desired link lengths and input angle. The implementation can be seen below:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p0_ini <span class="op">=</span> <span class="dv">0</span>,<span class="dv">0</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>p1_ini <span class="op">=</span> <span class="dv">1</span>,<span class="dv">0</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>p2_ini <span class="op">=</span> <span class="dv">1</span>,<span class="dv">1</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>p3_ini <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>p4_ini <span class="op">=</span> <span class="fl">.5</span>,<span class="op">-</span><span class="fl">.5</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>p_ini <span class="op">=</span> numpy.array([p0_ini,p1_ini,p2_ini,p3_ini,p4_ini])</span></code></pre></div>
<p>define a list of label strings for labeling points</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>point_text <span class="op">=</span> [<span class="st">&#39;p0&#39;</span>,<span class="st">&#39;p1&#39;</span>,<span class="st">&#39;p2&#39;</span>,<span class="st">&#39;p3&#39;</span>,<span class="st">&#39;p4&#39;</span>]</span></code></pre></div>
<p>Define a list of vectors by the index of the points used</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>vector_order <span class="op">=</span> []</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>vector_order.append((<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>vector_order.append((<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>vector_order.append((<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>vector_order.append((<span class="dv">3</span>,<span class="dv">0</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>vector_order.append((<span class="dv">2</span>,<span class="dv">4</span>))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>vector_order.append((<span class="dv">3</span>,<span class="dv">4</span>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>vector_order <span class="op">=</span> numpy.array(vector_order)</span></code></pre></div>
<p>For each vector, define the initial vector as the difference from point 1 minus point 0</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>v_ini <span class="op">=</span> p_ini[vector_order[:,<span class="dv">1</span>]]<span class="op">-</span>p_ini[vector_order[:,<span class="dv">0</span>]]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>v_ini</span></code></pre></div>
<pre><code>array([[ 1. ,  0. ],
       [ 0. ,  1. ],
       [-2. , -2. ],
       [ 1. ,  1. ],
       [-0.5, -1.5],
       [ 1.5,  0.5]])</code></pre>
<p>Calculate the initial length</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>l_ini <span class="op">=</span> [length(item) <span class="cf">for</span> item <span class="kw">in</span> v_ini]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>l_ini</span></code></pre></div>
<pre><code>[1.0,
 1.0,
 2.8284271247461903,
 1.4142135623730951,
 1.5811388300841898,
 1.5811388300841898]</code></pre>
<p>Compute the text location as halfway between point 0 and 1 for each vector</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>text_location <span class="op">=</span> (p_ini[vector_order[:,<span class="dv">1</span>]]<span class="op">+</span>p_ini[vector_order[:,<span class="dv">0</span>]])<span class="op">/</span><span class="dv">2</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>text_location</span></code></pre></div>
<pre><code>array([[ 0.5 ,  0.  ],
       [ 1.  ,  0.5 ],
       [ 0.  ,  0.  ],
       [-0.5 , -0.5 ],
       [ 0.75,  0.25],
       [-0.25, -0.75]])</code></pre>
<p>Add labels for labeling the vector midpoint</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>vector_text <span class="op">=</span> [<span class="st">&#39;v0&#39;</span>,<span class="st">&#39;v1&#39;</span>,<span class="st">&#39;v2&#39;</span>,<span class="st">&#39;v3&#39;</span>,<span class="st">&#39;v4&#39;</span>,<span class="st">&#39;v5&#39;</span>]</span></code></pre></div>
<p>Create a function that plots a mechanism</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_mechanism(point_location,text_location<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> item <span class="kw">in</span> vector_order:</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        plt.plot(<span class="op">*</span>(point_location[item,:<span class="dv">3</span>].T),<span class="st">&#39;ko-&#39;</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> text_location <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> item,text <span class="kw">in</span> <span class="bu">zip</span>(point_location,point_text):</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            ax.text(x<span class="op">=</span>item[<span class="dv">0</span>],y<span class="op">=</span>item[<span class="dv">1</span>],s<span class="op">=</span>text)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> item,text <span class="kw">in</span> <span class="bu">zip</span>(text_location,vector_text):</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            ax.text(x<span class="op">=</span>item[<span class="dv">0</span>],y<span class="op">=</span>item[<span class="dv">1</span>],s<span class="op">=</span>text)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()<span class="op">;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>plot_mechanism(p_ini,text_location)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="output_27_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gen_function(q1,dl1,dl2,dl3,dl4,dl5,dl6):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> calc_fourbar(arguments):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># break arguments variable into 8 discrete variables, 2 for each planar point in the four-bar linkage</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        x0,y0,x1,y1,x2,y2,x3,y3,x4,y4 <span class="op">=</span> arguments</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Create four points: p1, p2, p3, p4</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        p0 <span class="op">=</span> numpy.array([x0,y0])</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        p1 <span class="op">=</span> numpy.array([x1,y1])</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        p2 <span class="op">=</span> numpy.array([x2,y2])</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        p3 <span class="op">=</span> numpy.array([x3,y3])</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        p4 <span class="op">=</span> numpy.array([x4,y4])</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">#create new point array using inputs of function</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> numpy.array([p0,p1,p2,p3,p4])</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">#create new vector array using vector ordering defined above</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> p[vector_order[:,<span class="dv">1</span>]]<span class="op">-</span>p[vector_order[:,<span class="dv">0</span>]]</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">#create new length vector</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        l <span class="op">=</span> [length(item) <span class="cf">for</span> item <span class="kw">in</span> v]</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Define the x and y axis unit vectors</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        x_axis <span class="op">=</span> numpy.array([<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        y_axis <span class="op">=</span> numpy.array([<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># define the error variable for holding all mechanism error calcs</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>        error <span class="op">=</span> []</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Compute the error in the structure as the absolute, cumulative </span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># difference between the link lengths and their desired lengths</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        error.append([l[<span class="dv">0</span>]<span class="op">-</span>dl1])</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>        error.append([l[<span class="dv">1</span>]<span class="op">-</span>dl2])</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>        error.append([l[<span class="dv">2</span>]<span class="op">-</span>dl3])</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>        error.append([l[<span class="dv">3</span>]<span class="op">-</span>dl4])</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>        error.append([l[<span class="dv">4</span>]<span class="op">-</span>dl5])</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>        error.append([l[<span class="dv">5</span>]<span class="op">-</span>dl6])</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add the desired input angle q1 minus the actual angle as another error component to be solved</span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>        error.append([total_angle(v[<span class="dv">0</span>],<span class="op">-</span>v[<span class="dv">3</span>])<span class="op">-</span>q1<span class="op">*</span>math.pi<span class="op">/</span><span class="dv">180</span>])</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">#error.append([inner_angle(-v4,y_axis)-q1*math.pi/180+math.pi/2])</span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add two more constraints defining p1 as fixed at (0,0)</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>        error.append([p[<span class="dv">0</span>,<span class="dv">0</span>]<span class="op">-</span><span class="dv">0</span>])</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>        error.append([p[<span class="dv">0</span>,<span class="dv">1</span>]<span class="op">-</span><span class="dv">0</span>])</span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># define v1 to be parallel to the x axis.</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>        error.append([inner_angle(v[<span class="dv">0</span>],x_axis)<span class="op">-</span><span class="dv">0</span>])</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># turn the error list into a vector</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>        error1 <span class="op">=</span>numpy.array(error)</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># return the square root of the sum of squared errors.  The length function that we wrote earlier does that.</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> length(error1)</span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> calc_fourbar</span></code></pre></div>
<p>To test the function we simply need to create a valid initial guess for the initial locations of the 8 variables <code>x1,y1,x2,y2,x3,y3,x4,y4</code></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ini <span class="op">=</span> <span class="bu">list</span>(p_ini.flatten())</span></code></pre></div>
<p>as well as a set of design variables for <code>dl1,dl2,dl3,dl4</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>design <span class="op">=</span> numpy.array([<span class="dv">4</span>,<span class="dv">2</span>,<span class="fl">4.4</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">3</span>])</span></code></pre></div>
<p>and a state for the one configuration variable <code>q1</code></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>q1<span class="op">=-</span><span class="dv">170</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>function<span class="op">=</span>gen_function(q1,<span class="op">*</span>design)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>result  <span class="op">=</span> scipy.optimize.minimize(function,ini)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> result.x</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span>x.reshape((<span class="dv">5</span>,<span class="dv">2</span>))</span></code></pre></div>
<p>Compute the error of the resulting configuration found. If it is near zero, it was able to find a solution</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>result.fun</span></code></pre></div>
<pre><code>9.026945578091845e-08</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure()<span class="op">;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fig.add_subplot(<span class="dv">111</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plot_mechanism(x)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="output_38_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<h2 id="computing-a-path">Computing a Path</h2>
<p>But what if we want to compute more than one configuration in the same plot? We need to re-run the optimize function with different values for q. The example below does just that. Additionally, we only want to show valid solutions, so we add some error proofing to check whether a solution has error below a desired tolerance.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>all_q <span class="op">=</span> numpy.r_[<span class="op">-</span><span class="dv">170</span>:<span class="dv">181</span>:<span class="dv">10</span>]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> []</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>q_in <span class="op">=</span> []</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>ini<span class="op">=</span>result.x</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q1 <span class="kw">in</span> all_q:</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    function<span class="op">=</span>gen_function(q1,<span class="op">*</span>design)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    result  <span class="op">=</span> scipy.optimize.minimize(function,ini)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    points <span class="op">=</span> result.x</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    points <span class="op">=</span>points.reshape((<span class="dv">5</span>,<span class="dv">2</span>))</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only add solution to path if the error is smaller than some nominal value</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(result.fun)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result.fun<span class="op">&lt;</span><span class="fl">1e-1</span>:</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        path.append(points)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        q_in.append(q1)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        ini <span class="op">=</span> result.x</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> numpy.array(path)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>q_in <span class="op">=</span> numpy.array(q_in)</span></code></pre></div>
<pre><code>8.954604775481941e-08
1.0605149701359381e-07
1.1603444240028001e-07
1.2568357289407063e-07
1.3252296031531973e-07
1.303927497546157e-07
1.1055470659842001e-07
1.0347870343210644e-07
1.4326399272675837e-07
1.1309582318996748e-07
1.4207654357420516e-07
2.4060996478020476e-07
1.7810528407780235e-07
1.5975008557724472e-07
9.590066657917192e-08
1.7700686447282094e-07
3.9566333144106975e-08
1.1876719247582358e-07
1.1655392361752263e-07
1.0429181687303234e-07
7.127932217128096e-08
9.680282350805894e-08
1.048837227646731e-07
1.1962328720255813e-07
1.0626426656512877e-07
9.631685415663405e-08
7.675044388829596e-08
9.505238600853311e-08
8.780147577786808e-08
7.0653811899816e-08
7.419618998681557e-08
1.324904732467908e-07
9.914423485684517e-08
1.0736378471729707e-07
1.3780530211060153e-07
0.05964248047601034</code></pre>
<p>Plotting the resultâ€¦</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> plt.figure()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> f.add_subplot(<span class="dv">111</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> item <span class="kw">in</span> path:</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    plot_mechanism(item)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;f1.png&#39;</span>)</span></code></pre></div>
<figure>
<img src="output_42_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<h2 id="computing-the-jacobian">Computing The Jacobian</h2>
<p>Now consider we want to look at an end-effector attached to <span class="math inline">\(\vec{v}_3\)</span>. Plotting the end effector p4:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>path.shape</span></code></pre></div>
<pre><code>(36, 5, 2)</code></pre>
<p>This plots as the following set of points:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>p4 <span class="op">=</span> path[:,<span class="dv">4</span>,:]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#p4 = numpy.r_[p4,p4[0:1]]</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.plot(p4[:,<span class="dv">0</span>],p4[:,<span class="dv">1</span>],<span class="st">&#39;go-&#39;</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;f2.png&#39;</span>)</span></code></pre></div>
<figure>
<img src="output_46_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>But what if weâ€™re only interested in the portion of the path where the end effector is supposed to be touching the ground? Restricting to that portion of the path:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>y_out <span class="op">=</span> numpy.vstack([p4,p4[<span class="dv">0</span>:<span class="dv">2</span>]])</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>y_out</span></code></pre></div>
<pre><code>array([[ 0.64264254, -2.69384769],
       [ 0.78280718, -2.79823563],
       [ 0.95188291, -2.8864637 ],
       [ 1.14481075, -2.95549861],
       [ 1.35560972, -3.00354476],
       [ 1.57761493, -3.03016872],
       [ 1.80367928, -3.0363504 ],
       [ 2.02632015, -3.02444964],
       [ 2.23779278, -2.99806986],
       [ 2.43010901, -2.96177109],
       [ 2.5950436 , -2.92057243],
       [ 2.72424758, -2.87916311],
       [ 2.80967609, -2.8407959 ],
       [ 2.84463886, -2.80599016],
       [ 2.82567066, -2.77151734],
       [ 2.75487825, -2.73055566],
       [ 2.64131427, -2.6748451 ],
       [ 2.49927046, -2.59849738],
       [ 2.34322112, -2.50118147],
       [ 2.18279366, -2.38830951],
       [ 2.02157383, -2.26852096],
       [ 1.85940193, -2.15087843],
       [ 1.69523185, -2.04329027],
       [ 1.52883454, -1.9520413 ],
       [ 1.3613649 , -1.88182059],
       [ 1.19531722, -1.83586462],
       [ 1.03425538, -1.81608168],
       [ 0.8824903 , -1.8231402 ],
       [ 0.74476959, -1.85653494],
       [ 0.62598402, -1.91465079],
       [ 0.5308936 , -1.99483816],
       [ 0.46386041, -2.09351186],
       [ 0.4285866 , -2.2062853 ],
       [ 0.4278607 , -2.32814798],
       [ 0.46332547, -2.45369081],
       [ 0.50264674, -2.53318552],
       [ 0.64264254, -2.69384769],
       [ 0.78280718, -2.79823563]])</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>q_in <span class="op">=</span> numpy.r_[q_in,q_in[<span class="dv">0</span>:<span class="dv">2</span>]]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>q_in</span></code></pre></div>
<pre><code>array([-170, -160, -150, -140, -130, -120, -110, -100,  -90,  -80,  -70,
        -60,  -50,  -40,  -30,  -20,  -10,    0,   10,   20,   30,   40,
         50,   60,   70,   80,   90,  100,  110,  120,  130,  140,  150,
        160,  170,  180, -170, -160])</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>range_min <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>range_max <span class="op">=</span> <span class="dv">11</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> range_min<span class="op">&gt;=</span><span class="dv">0</span>:</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    y_out <span class="op">=</span> p4[range_min:range_max]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    q_in <span class="op">=</span> q_in[range_min:range_max]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    y_out <span class="op">=</span> numpy.vstack([p4[range_min:,:],p4[<span class="dv">0</span>:range_max,:]])</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    q_in <span class="op">=</span> numpy.r_[q_in[range_min:],q_in[<span class="dv">0</span>:range_max]]</span></code></pre></div>
<p>Now we may calculate the relative change in position of the end-effector (in green) between each step as a function of the change in input angle <span class="math inline">\(q\)</span>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> plt.figure()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> f.add_subplot(<span class="dv">111</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#for item in path[range_min:range_max]:</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    plot_mechanism(item)</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>a.plot(p4[:,<span class="dv">0</span>],p4[:,<span class="dv">1</span>],<span class="st">&#39;go-&#39;</span>)    </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>a.plot(y_out[:,<span class="dv">0</span>],y_out[:,<span class="dv">1</span>],<span class="st">&#39;ro-&#39;</span>)    </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;f3.png&#39;</span>)</span></code></pre></div>
<figure>
<img src="output_53_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>We use the trapezoidal rule to find the slope in y as a function of the previous and next neighbors of each point in the path. For a path of n points this will produce n-2 sets of partial derivatives</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dy <span class="op">=</span> y_out[<span class="dv">2</span>:,:]<span class="op">-</span>y_out[:<span class="op">-</span><span class="dv">2</span>,:]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>dy</span></code></pre></div>
<pre><code>array([[ 0.30924037, -0.19261601],
       [ 0.36200357, -0.15726298],
       [ 0.40372681, -0.11708106],
       [ 0.43280418, -0.0746701 ],
       [ 0.44806955, -0.03280564],
       [ 0.44870522,  0.00571908],
       [ 0.4341135 ,  0.03828054],
       [ 0.40378886,  0.06267855],
       [ 0.35725082,  0.07749743]])</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dq <span class="op">=</span> q_in[<span class="dv">2</span>:]<span class="op">-</span>q_in[:<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>dq</span></code></pre></div>
<pre><code>array([20, 20, 20, 20, 20, 20, 20, 20, 20])</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dq.shape</span></code></pre></div>
<pre><code>(9,)</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> plt.figure()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> f.add_subplot(<span class="dv">111</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">#for item in path[range_min:range_max]:</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    plot_mechanism(item)</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>a.plot(p4[:,<span class="dv">0</span>],p4[:,<span class="dv">1</span>],<span class="st">&#39;go-&#39;</span>)    </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>a.plot(y_out[:,<span class="dv">0</span>],y_out[:,<span class="dv">1</span>],<span class="st">&#39;ro-&#39;</span>)    </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">&#39;f3.png&#39;</span>)</span></code></pre></div>
<figure>
<img src="output_58_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>plt.plot(y_out[:,<span class="dv">0</span>],y_out[:,<span class="dv">1</span>],<span class="st">&#39;ro-&#39;</span>)    </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>plt.quiver(y_out[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>,<span class="dv">0</span>],y_out[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>],dy[:,<span class="dv">0</span>],dy[:,<span class="dv">1</span>])</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">&#39;equal&#39;</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<figure>
<img src="output_59_0.png" alt="png" /><figcaption aria-hidden="true">png</figcaption>
</figure>
<p>Dividing dy over dq produces 10, 2x1 Jacobian matrices, 1 for each interior point in the motion path.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>J<span class="op">=</span>(dy.T<span class="op">/</span>dq.T)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>J.shape</span></code></pre></div>
<pre><code>(2, 9)</code></pre>
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>J</span></code></pre></div>
<pre><code>array([[ 0.01546202,  0.01810018,  0.02018634,  0.02164021,  0.02240348,
         0.02243526,  0.02170567,  0.02018944,  0.01786254],
       [-0.0096308 , -0.00786315, -0.00585405, -0.00373351, -0.00164028,
         0.00028595,  0.00191403,  0.00313393,  0.00387487]])</code></pre>
<p>Now letâ€™s find the torque required to accelerage a 1-kg mass forward at 1g, while holding itself up against gravity:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> <span class="dv">1</span> <span class="co">#kg</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> <span class="fl">9.81</span> <span class="co">#m/s^2</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>fx <span class="op">=</span> m<span class="op">*</span>g</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>fy <span class="op">=</span> <span class="op">-</span>m<span class="op">*</span>g</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> numpy.array([[fx,fy]]).T</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> J.T.dot(f)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>t <span class="co">#N-m</span></span></code></pre></div>
<pre><code>array([[0.24616055],
       [0.25470025],
       [0.25545626],
       [0.24891613],
       [0.23586928],
       [0.2172847 ],
       [0.19415607],
       [0.1673146 ],
       [0.13721904]])</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>t.<span class="bu">max</span>()</span></code></pre></div>
<pre><code>0.2554562621161284</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>t.<span class="bu">min</span>()</span></code></pre></div>
<pre><code>0.13721904119448364</code></pre>
<p>Thus, the torque required by a motor to hold those forces specified by <span class="math inline">\(f_x\)</span> and <span class="math inline">\(f_y\)</span> is around .25 N-m in the worst case.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>motor_speed <span class="op">=</span> <span class="dv">500</span><span class="co">#rpm</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>dq_dt <span class="op">=</span> motor_speed<span class="op">*</span><span class="dv">2</span><span class="op">*</span>math.pi<span class="op">/</span><span class="dv">60</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>velocity <span class="op">=</span> J<span class="op">*</span>dq_dt</span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>velocity[<span class="dv">0</span>,:]</span></code></pre></div>
<pre><code>array([0.80958939, 0.94772314, 1.05695432, 1.13307869, 1.17304335,
       1.17470752, 1.13650647, 1.05711675, 0.93528047])</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>f</span></code></pre></div>
<pre><code>array([[ 9.81],
       [-9.81]])</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> t.dot(dq_dt)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>P</span></code></pre></div>
<pre><code>array([[12.88893637],
       [13.33607372],
       [13.37565861],
       [13.0332183 ],
       [12.35008672],
       [11.37700052],
       [10.1659878 ],
       [ 8.76057221],
       [ 7.1847722 ]])</code></pre>

</main><!-- /.container -->
<footer class="blog-footer">
  

  <p>Copyright &copy; 2020 Daniel M. Aukes.  All rights reserved.</p>
  <p><a href="#">Back to top</a></p>
</footer>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>
